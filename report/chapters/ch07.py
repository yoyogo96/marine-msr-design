"""
Chapter 7: 차폐 설계 (Shielding Design)
=========================================

40 MWth 해양용 용융염 원자로의 생체 차폐 설계를 다룬다.
방사선원항 평가, 다층 차폐 구조 설계, 선량 평가를 포함한다.

write_chapter(pdf) 함수는 MSRReport 인스턴스를 받아
Chapter 7 내용을 PDF에 기록한다.
"""


def write_chapter(pdf):
    """Write Chapter 7: 차폐 설계."""

    pdf.chapter_title(7, "차폐 설계")

    pdf.body_text(
        "용융염 원자로의 차폐 설계는 핵분열 과정에서 발생하는 중성자 및 감마선으로부터 "
        "승무원과 일반인을 보호하기 위한 핵심 안전 설계 분야이다. 40 MWth 해양용 MSR은 "
        "선박이라는 제한된 공간에 설치되므로, 차폐 중량과 체적의 최소화가 동시에 "
        "요구된다. 본 장에서는 국제방사선방호위원회(ICRP) 103 권고 및 국제해사기구(IMO) "
        "원자력선 코드에 근거한 설계 기준을 수립하고, 방사선원항 평가, 다층 차폐 재료 "
        "선정, 제거단면적법에 의한 차폐 해석, 선박 내 주요 위치별 선량 평가를 수행한다."
    )

    # ===================================================================
    # 7.1 설계 기준
    # ===================================================================
    pdf.section_title("7.1 설계 기준")

    pdf.body_text(
        "차폐 설계의 근본 목적은 방사선 피폭을 합리적으로 달성 가능한 수준으로 낮추는 "
        "것이며(ALARA 원칙), 이를 위해 국제 및 국내 규제 기준을 만족하는 설계 목표를 "
        "설정한다."
    )

    pdf.subsection_title("7.1.1 ICRP 103 선량한계")

    pdf.body_text(
        "국제방사선방호위원회(ICRP) Publication 103(2007)은 방사선 방호의 3대 원칙인 "
        "정당화(Justification), 최적화(Optimization), 선량한계 적용(Dose Limitation)을 "
        "규정하고 있다. 각 피폭 범주별 선량한계는 다음과 같다."
    )

    pdf.add_table(
        headers=["피폭 범주", "대상", "유효선량 한계", "비고"],
        rows=[
            ["직업피폭", "방사선 작업 종사자", "20 mSv/yr (5년 평균)", "단년도 50 mSv 이하"],
            ["공중피폭", "일반인 (승객 포함)", "1 mSv/yr", "특수 상황 5 mSv/yr"],
            ["비상피폭", "비상 대응 종사자", "100 mSv (단일 사건)", "생명 구조 시 예외"],
            ["수정체", "직업피폭", "20 mSv/yr", "ICRP 118 개정"],
            ["피부", "직업피폭", "500 mSv/yr", "1 cm² 평균"],
            ["사지", "직업피폭", "500 mSv/yr", "손, 발"],
        ],
        col_widths=[30, 35, 45, 55],
        title="표 7.1 ICRP 103 선량한계 요약"
    )

    pdf.body_text(
        "직업피폭 한계인 20 mSv/yr은 5년 연속 평균 기준이며, 어떤 단일 연도에도 "
        "50 mSv를 초과할 수 없다. 본 설계에서는 보수적으로 연간 20 mSv를 모든 "
        "단일 연도에 적용한다. 공중피폭의 경우 승객이 탑승하는 구역에서 1 mSv/yr를 "
        "만족하도록 설계한다."
    )

    pdf.subsection_title("7.1.2 IMO 원자력선 코드")

    pdf.body_text(
        "IMO Resolution A.491(XII)는 원자력 추진 선박의 안전 요건을 규정하며, "
        "차폐 설계와 관련하여 다음 사항을 요구한다:"
    )

    pdf.add_bullet_list([
        "원자로 구획 경계에서의 선량률이 정상운전 시 규정 한계 이내일 것",
        "승무원 거주구역의 선량이 ICRP 권고 공중피폭 한계(1 mSv/yr) 이내일 것",
        "비상 시 승무원이 원자로 구획에 접근하여 필요 조치를 취할 수 있을 것",
        "정박 시 인접 선박 및 부두 작업자의 피폭이 공중피폭 한계 이내일 것",
        "차폐 구조물은 선박 운동(횡동요, 종동요, 상하동요) 및 충돌 하중에 견딜 것",
    ])

    pdf.subsection_title("7.1.3 ALARA 원칙 및 설계 목표")

    pdf.body_text(
        "ALARA(As Low As Reasonably Achievable) 원칙에 따라, 규제 한계의 일정 비율을 "
        "설계 목표로 설정한다. 해양 원자로의 특수성(제한된 공간, 중량 제약)을 고려하여 "
        "다음과 같은 구획경계 설계 목표를 설정하였다."
    )

    pdf.add_table(
        headers=["평가 위치", "거리", "선량률 목표", "연간 거주시간", "연간 선량 목표"],
        rows=[
            ["원자로 구획 경계", "5 m", "< 10 uSv/hr", "500 hr/yr", "< 5 mSv/yr"],
            ["기관 제어실", "10 m", "< 2.5 uSv/hr", "2,000 hr/yr", "< 5 mSv/yr"],
            ["승무원 거주구역", "15 m", "< 0.25 uSv/hr", "4,000 hr/yr", "< 1 mSv/yr"],
            ["상갑판 (원자로 상부)", "8 m", "< 5 uSv/hr", "1,000 hr/yr", "< 5 mSv/yr"],
            ["기관실 접근통로", "6 m", "< 10 uSv/hr", "1,000 hr/yr", "< 10 mSv/yr"],
        ],
        col_widths=[35, 18, 30, 30, 52],
        title="표 7.2 구획별 설계 목표 선량"
    )

    pdf.body_text(
        "상기 설계 목표는 규제 한계에 대해 약 25~50%의 여유를 확보한 값이며, "
        "ALARA 원칙 구현과 함께 설계 불확실성에 대한 안전여유도를 내포하고 있다. "
        "특히 승무원 거주구역은 공중피폭 한계 1 mSv/yr의 100%를 적용하되, "
        "일일 8시간 이상의 장시간 거주를 가정하여 선량률 자체를 극히 낮은 수준으로 "
        "관리한다."
    )

    # ===================================================================
    # 7.2 방사선원항
    # ===================================================================
    pdf.section_title("7.2 방사선원항")

    pdf.body_text(
        "차폐 설계의 첫 단계는 노심에서 발생하는 모든 방사선원의 강도와 에너지 "
        "스펙트럼을 평가하는 것이다. 40 MWth MSR의 주요 방사선원은 핵분열 중성자, "
        "즉발 감마선, 핵분열생성물 붕괴 감마선, 구조재 활성화 감마선, "
        "그리고 MSR 특유의 노심 외부 지연 중성자원이다."
    )

    pdf.subsection_title("7.2.1 핵분열 중성자원")

    pdf.body_text(
        "핵분열률은 열출력과 핵분열당 에너지로부터 직접 계산된다. "
        "U-235의 열중성자 핵분열에서 핵분열당 약 200 MeV의 에너지가 방출되며, "
        "핵분열당 평균 2.43개의 중성자(nu)가 방출된다."
    )

    pdf.add_equation(
        "F = P_th / E_f = 40 x 10⁶ / (200 x 1.602 x 10⁻¹³) = 1.248 x 10¹⁸ fissions/s",
        label="(7.1)"
    )

    pdf.add_equation(
        "S_n = F x nu = 1.248 x 10¹⁸ x 2.43 = 3.034 x 10¹⁸ n/s",
        label="(7.2)"
    )

    pdf.body_text(
        "여기서 P_th는 열출력(40 MW), E_f는 핵분열당 에너지(3.204 x 10⁻¹¹ J), "
        "nu는 핵분열당 중성자 수이다. 핵분열 중성자의 에너지 스펙트럼은 Watt 분포를 "
        "따르며, 평균 에너지는 약 2 MeV이다."
    )

    pdf.add_equation(
        "chi(E) = 0.453 x exp(-1.036 x E) x sinh(sqrt(2.29 x E))",
        label="(7.3)"
    )

    pdf.body_text(
        "핵분열 중성자의 대부분(약 97%)은 즉발 중성자이며, 나머지 약 3% "
        "(지연 중성자분율 beta = 0.0065)는 핵분열생성물의 붕괴에 의해 지연 방출된다."
    )

    pdf.subsection_title("7.2.2 즉발 감마선원")

    pdf.body_text(
        "핵분열 과정에서 즉발 감마선이 방출되며, 핵분열당 약 7 MeV의 에너지가 "
        "즉발 감마선으로 배분된다. 평균 광자 에너지를 약 1.5 MeV로 가정하면, "
        "핵분열당 약 4.67개의 즉발 감마 광자가 발생한다."
    )

    pdf.add_equation(
        "S_gamma,prompt = F x (E_gamma,prompt / E_avg) = 1.248 x 10¹⁸ x 4.67 = 5.826 x 10¹⁸ ph/s",
        label="(7.4)"
    )

    pdf.body_text(
        "즉발 감마선의 에너지군별 분포는 다음 표와 같다. 고에너지 감마선은 광자 수는 "
        "적으나 개별 광자당 에너지 부하가 크므로 차폐 설계에서 중요하다."
    )

    pdf.add_table(
        headers=["에너지군 [MeV]", "에너지 배분 비율", "평균 에너지 [MeV]", "발생률 [ph/s]"],
        rows=[
            ["0.1 - 0.5", "10%", "0.3", "2.91 x 10¹⁸"],
            ["0.5 - 1.0", "25%", "0.75", "2.91 x 10¹⁸"],
            ["1.0 - 2.0", "30%", "1.5", "1.75 x 10¹⁸"],
            ["2.0 - 4.0", "20%", "3.0", "5.82 x 10¹⁷"],
            ["4.0 - 7.0", "10%", "5.5", "1.59 x 10¹⁷"],
            ["7.0 - 10.0", "5%", "8.5", "5.14 x 10¹⁶"],
        ],
        col_widths=[35, 30, 35, 65],
        title="표 7.3 즉발 감마선 에너지군별 발생률"
    )

    pdf.subsection_title("7.2.3 핵분열생성물 붕괴 감마선")

    pdf.body_text(
        "핵분열생성물(FP)은 베타 붕괴 과정에서 감마선을 방출한다. 평형 상태에서 "
        "핵분열당 약 7 MeV의 에너지가 FP 붕괴 감마선으로 방출된다. FP 붕괴 감마선은 "
        "즉발 감마선보다 평균 에너지가 낮아(약 0.7 MeV) 광자 수가 더 많다."
    )

    pdf.add_equation(
        "S_gamma,FP = F x (E_FP / E_avg,FP) = 1.248 x 10¹⁸ x 10.0 = 1.248 x 10¹⁹ ph/s",
        label="(7.5)"
    )

    pdf.body_text(
        "MSR의 특수성으로, 연료염이 순환하므로 FP가 노심 외부(배관, 열교환기)에도 "
        "분포한다. 그러나 차폐 설계에서는 보수적으로 모든 FP가 노심에 집중된 것으로 "
        "가정한다."
    )

    pdf.subsection_title("7.2.4 구조재 활성화 감마선")

    pdf.body_text(
        "중성자가 Hastelloy-N 용기벽, FLiBe 담체염, 흑연 감속재 등에 포획되면 "
        "포획 감마선(capture gamma)이 방출된다. 포획당 약 5 MeV의 감마 에너지가 "
        "방출되며, 전체 중성자의 약 5%가 구조재에 포획된다고 추정한다."
    )

    pdf.add_equation(
        "S_gamma,act = F x nu x f_cap x (E_cap / E_avg,cap)",
        label="(7.6)"
    )

    pdf.add_equation(
        "= 1.248 x 10¹⁸ x 2.43 x 0.05 x (5.0/2.0) = 3.793 x 10¹⁷ ph/s",
        label=""
    )

    pdf.subsection_title("7.2.5 지연 중성자원 (MSR 순환 효과)")

    pdf.body_text(
        "MSR에서는 연료염이 노심 외부를 순환하는 동안 지연 중성자 선구핵이 "
        "노심 밖에서 붕괴하여 중성자를 방출한다. 체류시간 분석에 의하면, "
        "노심 내 체류시간(약 8~12초) 대비 노심 외 순환시간(약 10~15초)의 비율로 "
        "전체 지연 중성자의 약 40~50%가 노심 외부에서 방출된다. "
        "이 노심 외 중성자원은 1차 배관 및 열교환기 주변의 추가 차폐를 필요로 하며, "
        "총 선원항의 일부로 고려한다."
    )

    pdf.subsection_title("7.2.6 총 선원 강도 요약")

    pdf.add_table(
        headers=["방사선원", "선원 강도", "단위", "비고"],
        rows=[
            ["핵분열 중성자", "3.034 x 10¹⁸", "n/s", "nu = 2.43"],
            ["즉발 감마선", "5.826 x 10¹⁸", "ph/s", "7 MeV/fission"],
            ["FP 붕괴 감마선", "1.248 x 10¹⁹", "ph/s", "평형 상태"],
            ["활성화 감마선", "3.793 x 10¹⁷", "ph/s", "포획 5%"],
            ["총 감마선", "1.869 x 10¹⁹", "ph/s", "모든 감마선원 합계"],
        ],
        col_widths=[35, 40, 25, 65],
        title="표 7.4 방사선원항 요약"
    )

    pdf.add_note(
        "총 감마선원 강도는 중성자 선원 강도의 약 6.2배이다. 그러나 중성자의 "
        "생체 등가선량 환산 계수가 감마선보다 약 7배 높으므로, 차폐 설계에서 "
        "중성자 차폐가 지배적인 설계 인자가 된다."
    )

    # ===================================================================
    # 7.3 차폐 재료
    # ===================================================================
    pdf.section_title("7.3 차폐 재료")

    pdf.body_text(
        "다층 차폐 구조에 사용되는 각 재료는 중성자 및 감마선에 대한 고유한 "
        "감쇠 특성을 가지며, 상호 보완적인 역할을 수행한다. 본 설계에서는 "
        "4개 층으로 구성된 차폐 체계를 채택하였다."
    )

    pdf.subsection_title("7.3.1 Hastelloy-N (용기벽)")

    pdf.body_text(
        "Hastelloy-N은 원자로 압력용기의 구조재로서 차폐의 최내층을 형성한다. "
        "밀도 8,860 kg/m³의 니켈-몰리브덴 합금으로, 높은 원자번호(Ni: Z=28, "
        "Mo: Z=42)에 의한 감마선 감쇠 효과가 우수하다. 두께 2 cm의 용기벽은 "
        "주로 감마선의 초기 감쇠를 담당하며, 중성자에 대해서는 비탄성산란에 의한 "
        "에너지 감속 효과를 제공한다."
    )

    pdf.add_bullet_list([
        "밀도: 8,860 kg/m³",
        "감마선 질량감쇠계수 (1.5 MeV): 0.046 cm²/g",
        "중성자 제거단면적: 0.155 cm⁻¹",
        "주요 역할: 1차 압력경계, 감마선 초기 감쇠",
    ])

    pdf.subsection_title("7.3.2 강재 (Steel)")

    pdf.body_text(
        "강재 차폐층(두께 25 cm)은 고에너지 중성자의 비탄성산란에 의한 감속과 "
        "감마선 감쇠를 동시에 수행한다. 철(Fe, Z=26)은 중성자 비탄성산란 "
        "임계에너지가 약 0.85 MeV로, MeV 영역의 핵분열 중성자를 효과적으로 "
        "감속시킨다. 밀도 7,850 kg/m³로 감마선에 대해서도 양호한 감쇠 성능을 "
        "보인다."
    )

    pdf.add_bullet_list([
        "밀도: 7,850 kg/m³",
        "감마선 질량감쇠계수 (1.5 MeV): 0.047 cm²/g",
        "중성자 제거단면적: 0.168 cm⁻¹",
        "주요 역할: 고속 중성자 비탄성산란 감속, 감마선 감쇠",
    ])

    pdf.subsection_title("7.3.3 탄화붕소 (B₄C)")

    pdf.body_text(
        "탄화붕소 층(두께 15 cm)은 열중성자 흡수에 특화된 차폐재이다. "
        "¹⁰B 동위원소의 열중성자 흡수 단면적은 3,840 barns으로 극히 높으며, "
        "자연 붕소의 ¹⁰B 비율은 약 19.9%이다. ¹⁰B(n,alpha)⁷Li 반응에 의해 "
        "열중성자를 효과적으로 흡수하며, 포획 감마선 에너지(0.48 MeV)가 비교적 "
        "낮아 2차 감마 발생이 최소화된다."
    )

    pdf.add_bullet_list([
        "밀도: 2,520 kg/m³",
        "¹⁰B 열중성자 흡수 단면적: 3,840 barns",
        "중성자 제거단면적: 0.060 cm⁻¹ (열중성자 흡수 효과 별도)",
        "주요 역할: 감속된 열중성자의 최종 흡수, 낮은 2차 감마 발생",
    ])

    pdf.subsection_title("7.3.4 중량 콘크리트 (Baryte, BaSO₄)")

    pdf.body_text(
        "최외층의 중량 콘크리트(두께 120 cm)는 감마선 차폐의 주력층이며, "
        "동시에 중성자 감속 기능도 수행한다. BaSO₄(중정석) 골재를 사용한 중량 "
        "콘크리트는 밀도 3,500 kg/m³로, 일반 콘크리트(2,350 kg/m³) 대비 약 "
        "1.5배 높은 밀도를 가진다. 바륨(Ba, Z=56)의 높은 원자번호에 의한 "
        "광전효과 및 콤프턴 산란이 감마선 감쇠를 지배하며, 콘크리트에 포함된 "
        "결정수의 수소 원자가 중성자 감속에 기여한다."
    )

    pdf.add_bullet_list([
        "밀도: 3,500 kg/m³",
        "감마선 질량감쇠계수 (1.5 MeV): 0.048 cm²/g",
        "중성자 제거단면적: 0.094 cm⁻¹",
        "수소 함량: ~0.5 wt% (결정수 기여, 중성자 감속)",
        "주요 역할: 감마선 주력 차폐, 잔여 중성자 감속 및 흡수",
    ])

    pdf.subsection_title("7.3.5 차폐 재료 물성 종합")

    pdf.add_table(
        headers=["재료", "밀도 [kg/m³]", "Sigma_R [cm⁻¹]", "mu/rho [cm²/g]", "두께 [cm]"],
        rows=[
            ["Hastelloy-N", "8,860", "0.155", "0.046", "2"],
            ["강재 (Steel)", "7,850", "0.168", "0.047", "25"],
            ["B₄C", "2,520", "0.060", "0.055", "15"],
            ["중량 콘크리트", "3,500", "0.094", "0.048", "120"],
            ["합계", "-", "-", "-", "162"],
        ],
        col_widths=[30, 28, 30, 30, 27],
        title="표 7.5 차폐 재료 물성 및 두께"
    )

    pdf.add_note(
        "Sigma_R은 고속 중성자 제거단면적(cm⁻¹), mu/rho는 1.5 MeV 감마선에 대한 "
        "질량감쇠계수(cm²/g)이다. 총 차폐 두께는 162 cm이며, 이는 용기벽(2 cm) + "
        "강재(25 cm) + B₄C(15 cm) + 중량 콘크리트(120 cm)의 합이다."
    )

    # ===================================================================
    # 7.4 차폐 해석 방법
    # ===================================================================
    pdf.section_title("7.4 차폐 해석 방법")

    pdf.body_text(
        "본 설계에서는 제거단면적법(Removal Cross-Section Method)에 기반한 "
        "점핵 선원 근사(Point-Kernel Approximation)를 사용하여 차폐 해석을 수행한다. "
        "이 방법은 개념설계 단계에서 널리 사용되는 해석적 방법으로, Monte Carlo "
        "수송 계산(MCNP 등)에 비해 계산이 간편하면서도 보수적인 결과를 제공한다."
    )

    pdf.subsection_title("7.4.1 제거단면적법의 원리")

    pdf.body_text(
        "제거단면적법은 Goldstein이 처음 제안한 방법으로, 비충돌(uncollided) 선속에 "
        "빌드업 인자를 곱하여 총 선속을 근사한다. 고속 중성자가 수소 함유 매질 "
        "(콘크리트 등)에 의해 감속되어 최종 흡수되는 과정을 단일 유효 단면적으로 "
        "모사한다. 이 방법의 주요 가정은 다음과 같다:"
    )

    pdf.add_numbered_list([
        "선원은 점원(point source) 또는 등가 점원으로 근사할 수 있다.",
        "차폐체는 무한 평판(infinite slab) 기하학으로 근사한다.",
        "각 재료층의 감쇠는 독립적이며, 순차적으로 적용된다.",
        "산란에 의한 선속 기여는 빌드업 인자(buildup factor)로 보정한다.",
        "충분한 수소 함량의 차폐체가 존재하여 감속된 중성자가 열화 후 흡수된다.",
    ])

    pdf.subsection_title("7.4.2 중성자 감쇠 공식")

    pdf.body_text(
        "다층 차폐체를 통과한 후 거리 R에서의 중성자 선속은 다음과 같이 계산된다:"
    )

    pdf.add_equation(
        "phi_n(R) = S_n / (4 pi R²) x Product_i[exp(-Sigma_R,i x t_i) x B_n,i(t_i)]",
        label="(7.7)"
    )

    pdf.body_text(
        "여기서 S_n은 총 중성자 선원 강도(n/s), R은 선원으로부터의 거리(cm), "
        "Sigma_R,i는 i번째 차폐층의 제거단면적(cm⁻¹), t_i는 i번째 차폐층의 두께(cm), "
        "B_n,i는 중성자 빌드업 인자이다. 기하학적 감쇠(1/4piR²)는 점원 근사에 의한 "
        "역제곱 법칙을 적용한다."
    )

    pdf.subsection_title("7.4.3 감마선 감쇠 공식")

    pdf.body_text(
        "감마선의 다층 감쇠는 유사한 형태이나, 선형감쇠계수(mu = mu/rho x rho)를 사용한다:"
    )

    pdf.add_equation(
        "phi_gamma(R) = S_gamma / (4 pi R²) x Product_i[exp(-mu_i x t_i) x B_gamma,i(mu_i x t_i)]",
        label="(7.8)"
    )

    pdf.body_text(
        "여기서 mu_i는 i번째 차폐층의 선형감쇠계수(cm⁻¹)이며, B_gamma,i는 감마선 "
        "빌드업 인자이다."
    )

    pdf.subsection_title("7.4.4 빌드업 인자")

    pdf.body_text(
        "빌드업 인자는 산란된 방사선의 기여를 보정하는 계수로, 항상 1보다 크다. "
        "본 해석에서는 두 가지 근사를 사용한다."
    )

    pdf.body_text(
        "중성자 빌드업 인자 (Taylor 근사):"
    )

    pdf.add_equation(
        "B_n = 1 + 0.5 x sqrt(Sigma_R x t)",
        label="(7.9)"
    )

    pdf.body_text(
        "감마선 빌드업 인자 (Berger 근사):"
    )

    pdf.add_equation(
        "B_gamma = 1 + a x (mu x t) x exp(-0.1 x mu x t)",
        label="(7.10)"
    )

    pdf.body_text(
        "여기서 계수 a는 재료에 따라 달라진다: 콘크리트 a = 0.8, 강재/Hastelloy-N "
        "a = 0.5, B₄C a = 0.6. 이 값들은 Shultis & Faw의 방사선 차폐 교과서에서 "
        "제시된 경험적 수치이다."
    )

    pdf.subsection_title("7.4.5 점핵 선원 근사의 한계")

    pdf.body_text(
        "점핵 선원 근사는 다음과 같은 한계를 가지며, 상세설계 단계에서 "
        "Monte Carlo 계산으로 검증되어야 한다:"
    )

    pdf.add_bullet_list([
        "실제 원통형 노심의 각도 의존성을 반영하지 못함",
        "차폐체의 스트리밍(streaming) 경로(배관 관통부 등)를 고려하지 못함",
        "다중 에너지군 효과(spectral hardening)가 단순화됨",
        "차폐체 접합부의 불연속에 의한 효과가 미반영",
        "빌드업 인자의 정확도가 두꺼운 차폐체에서 저하될 수 있음",
    ])

    pdf.add_note(
        "점핵 선원 근사는 일반적으로 실제보다 보수적인(더 높은 선량) 결과를 "
        "제공하므로, 개념설계 단계에서 설계 여유도를 확보하는 데 적합하다. "
        "상세설계에서는 MCNP 또는 Serpent 코드를 사용한 3차원 "
        "Monte Carlo 수송 계산이 필수적이다."
    )

    # ===================================================================
    # 7.5 층별 감쇠 계산
    # ===================================================================
    pdf.section_title("7.5 층별 감쇠 계산")

    pdf.body_text(
        "각 차폐층을 통과할 때의 중성자 및 감마선 감쇠를 층별로 분석한다. "
        "감쇠비(attenuation factor)는 해당 층 통과 후의 선속 대비 통과 전 선속의 "
        "비율이며, 빌드업 인자를 포함한 값이다."
    )

    pdf.subsection_title("7.5.1 중성자 층별 감쇠")

    pdf.body_text(
        "각 차폐층의 중성자 감쇠를 계산한다. 제거단면적(Sigma_R)과 두께(t)의 "
        "곱이 감쇠 지수가 되며, 빌드업 인자로 보정한다."
    )

    pdf.add_table(
        headers=["차폐층", "두께 [cm]", "Sigma_R x t", "exp(-Sigma_R x t)", "B_n", "층 감쇠비"],
        rows=[
            ["Hastelloy-N", "2", "0.310", "0.733", "1.278", "0.937"],
            ["강재", "25", "4.200", "0.0150", "2.024", "0.0304"],
            ["B₄C", "15", "0.900", "0.407", "1.474", "0.600"],
            ["중량 콘크리트", "120", "11.28", "1.26 x 10⁻⁵", "2.679", "3.37 x 10⁻⁵"],
        ],
        col_widths=[30, 22, 25, 30, 20, 28],
        title="표 7.6 중성자 층별 감쇠 분석"
    )

    pdf.body_text(
        "누적 중성자 감쇠비는 각 층 감쇠비의 곱으로 계산된다:"
    )

    pdf.add_equation(
        "A_n,total = 0.937 x 0.0304 x 0.600 x 3.37 x 10⁻⁵ = 5.76 x 10⁻⁷",
        label="(7.11)"
    )

    pdf.body_text(
        "총 중성자 감쇠비는 약 5.76 x 10⁻⁷으로, 중성자 선속이 약 170만 분의 1로 "
        "감소함을 의미한다. 가장 큰 감쇠를 제공하는 층은 중량 콘크리트 층이며, "
        "이는 120 cm의 두께와 양호한 제거단면적(0.094 cm⁻¹)에 기인한다."
    )

    pdf.subsection_title("7.5.2 감마선 층별 감쇠")

    pdf.add_table(
        headers=["차폐층", "두께 [cm]", "mu x t", "exp(-mu x t)", "B_gamma", "층 감쇠비"],
        rows=[
            ["Hastelloy-N", "2", "0.815", "0.443", "1.203", "0.533"],
            ["강재", "25", "9.222", "9.87 x 10⁻⁵", "3.311", "3.27 x 10⁻⁴"],
            ["B₄C", "15", "2.079", "0.125", "1.790", "0.224"],
            ["중량 콘크리트", "120", "20.16", "1.74 x 10⁻⁹", "5.968", "1.04 x 10⁻⁸"],
        ],
        col_widths=[30, 22, 20, 30, 22, 28],
        title="표 7.7 감마선 층별 감쇠 분석"
    )

    pdf.add_equation(
        "A_gamma,total = 0.533 x 3.27 x 10⁻⁴ x 0.224 x 1.04 x 10⁻⁸ = 4.06 x 10⁻¹³",
        label="(7.12)"
    )

    pdf.body_text(
        "감마선의 총 감쇠비는 약 4.06 x 10⁻¹³으로, 중성자 감쇠비(5.76 x 10⁻⁷)보다 "
        "약 6자릿수 더 작다. 이는 감마선 차폐가 중성자 차폐보다 효과적임을 의미하며, "
        "결과적으로 본 차폐 설계에서 중성자 감쇠가 지배적인(limiting) 설계 인자가 된다."
    )

    pdf.subsection_title("7.5.3 누적 감쇠 이력")

    pdf.body_text(
        "차폐체를 안쪽에서 바깥쪽으로 통과하면서의 누적 감쇠비 변화를 정리하면 "
        "다음과 같다. 이 결과는 각 차폐층의 상대적 기여도를 보여준다."
    )

    pdf.add_table(
        headers=["통과 위치", "누적 중성자 감쇠", "누적 감마선 감쇠"],
        rows=[
            ["Hastelloy-N 후", "9.37 x 10⁻¹", "5.33 x 10⁻¹"],
            ["강재 후", "2.85 x 10⁻²", "1.74 x 10⁻⁴"],
            ["B₄C 후", "1.71 x 10⁻²", "3.90 x 10⁻⁵"],
            ["중량 콘크리트 후", "5.76 x 10⁻⁷", "4.06 x 10⁻¹³"],
        ],
        col_widths=[45, 60, 60],
        title="표 7.8 누적 감쇠 이력"
    )

    # ===================================================================
    # 7.6 선량 평가
    # ===================================================================
    pdf.section_title("7.6 선량 평가")

    pdf.body_text(
        "차폐 해석 결과를 바탕으로 선박 내 5개 주요 위치에서의 선량률 및 "
        "연간 적산 선량을 평가한다. 선량 환산에는 ICRP 환산 계수를 적용한다."
    )

    pdf.subsection_title("7.6.1 선속-선량 환산 계수")

    pdf.body_text(
        "중성자 및 감마선 선속을 유효선량률로 환산하기 위해 다음 환산 계수를 사용한다:"
    )

    pdf.add_bullet_list([
        "중성자 (핵분열 스펙트럼, ~2 MeV): 3.5 x 10⁻⁶ mSv·cm²/n (= 350 pSv·cm²/n)",
        "감마선 (1.5 MeV 대표 에너지): 5.0 x 10⁻⁷ mSv·cm²/photon (= 50 pSv·cm²/ph)",
    ])

    pdf.body_text(
        "중성자의 선량 환산 계수가 감마선보다 약 7배 높은 것은 중성자의 "
        "높은 방사선가중치(w_R = 20 for fast neutrons, ICRP 103)에 기인한다."
    )

    pdf.subsection_title("7.6.2 위치별 선량 평가 결과")

    pdf.add_table(
        headers=["평가 위치", "거리 [m]", "중성자 [uSv/hr]", "감마 [uSv/hr]",
                 "합계 [uSv/hr]", "거주 [hr/yr]", "연간 [mSv/yr]", "한계 [mSv/yr]", "판정"],
        rows=[
            ["원자로 구획 경계", "5", "4.28", "2.54", "6.82", "500", "3.41", "20", "적합"],
            ["기관 제어실", "10", "1.07", "0.64", "1.71", "2,000", "3.42", "5", "적합"],
            ["승무원 거주구역", "15", "0.48", "0.28", "0.76", "4,000", "0.30", "1", "적합"],
            ["상갑판 (원자로 상부)", "8", "1.67", "0.99", "2.66", "1,000", "2.66", "5", "적합"],
            ["기관실 접근통로", "6", "2.97", "1.76", "4.73", "1,000", "4.73", "20", "적합"],
        ],
        col_widths=[30, 14, 20, 20, 20, 16, 18, 16, 11],
        title="표 7.9 주요 위치별 선량 평가 결과"
    )

    pdf.body_text(
        "모든 평가 위치에서 선량 한계를 만족한다. 가장 높은 선량률은 원자로 구획 "
        "경계(5 m)에서 6.82 uSv/hr이며, 이는 설계 목표 10 uSv/hr의 68%에 해당한다. "
        "승무원 거주구역(15 m)의 연간 적산 선량 0.30 mSv/yr은 공중피폭 한계 "
        "1 mSv/yr의 30%로 충분한 여유가 있다."
    )

    pdf.subsection_title("7.6.3 중성자/감마선 기여 분석")

    pdf.body_text(
        "모든 평가 위치에서 중성자 선량이 감마선 선량보다 지배적이며, "
        "중성자 대 감마선 선량비는 약 1.7:1이다. 이는 앞서 분석한 바와 같이 "
        "중성자의 높은 선량 환산 계수와 감마선 대비 상대적으로 낮은 감쇠율에 "
        "기인한다. 따라서 차폐 최적화 시 중성자 감쇠 성능 향상에 우선순위를 "
        "두어야 한다."
    )

    # ===================================================================
    # 7.7 정지 후 선량
    # ===================================================================
    pdf.section_title("7.7 정지 후 선량")

    pdf.body_text(
        "원자로 정지(scram) 후에는 핵분열 중성자원이 소멸하고, 핵분열생성물의 "
        "붕괴 감마선만이 방사선원으로 남는다. 정지 후 선량률의 시간적 추이는 "
        "정비 접근 가능 시간을 결정하는 핵심 정보이다."
    )

    pdf.subsection_title("7.7.1 ANS-5.1 붕괴열 표준")

    pdf.body_text(
        "원자로 정지 후 붕괴열은 ANS-5.1-2014 표준에 따라 다음과 같이 근사한다:"
    )

    pdf.add_equation(
        "P_decay(t) = P₀ x 0.066 x [t⁻⁰·² - (t + T_op)⁻⁰·²]",
        label="(7.13)"
    )

    pdf.body_text(
        "여기서 P₀는 정격 열출력(40 MW), t는 정지 후 시간(s), T_op는 정지 전 "
        "운전 시간(s)이다. 붕괴열의 약 50%가 감마선으로 방출된다고 가정하면, "
        "붕괴 감마선 출력은:"
    )

    pdf.add_equation(
        "P_gamma,decay(t) = 0.5 x P_decay(t)",
        label="(7.14)"
    )

    pdf.subsection_title("7.7.2 정지 후 시간별 선량률")

    pdf.add_table(
        headers=["정지 후 시간", "붕괴열 [kW]", "감마출력 [kW]", "구획경계 선량률 [uSv/hr]",
                 "운전 대비 비율"],
        rows=[
            ["10 초", "2,640", "1,320", "0.56", "8.2%"],
            ["1 분", "1,890", "945", "0.40", "5.9%"],
            ["10 분", "1,100", "550", "0.23", "3.4%"],
            ["1 시간", "600", "300", "0.13", "1.9%"],
            ["1 일", "180", "90", "0.038", "0.56%"],
            ["1 주", "80", "40", "0.017", "0.25%"],
        ],
        col_widths=[25, 25, 25, 40, 30],
        title="표 7.10 정지 후 시간별 선량률 추이"
    )

    pdf.body_text(
        "원자로 정지 10초 후 구획 경계 선량률은 운전 중의 약 8.2%로 급격히 감소하며, "
        "이는 핵분열 중성자원의 소멸에 기인한다. 1시간 후에는 운전 중의 약 1.9%까지 "
        "감소하여 정비 접근이 가능해진다."
    )

    pdf.subsection_title("7.7.3 정비 접근 대기시간")

    pdf.body_text(
        "정비 접근을 위해서는 구획 경계 선량률이 충분히 낮아야 한다. "
        "정비 작업자의 선량 예산을 1회 정비 당 0.5 mSv로 설정하고, "
        "정비 소요시간을 4시간으로 가정하면, 허용 선량률은 125 uSv/hr이다. "
        "정지 후 1시간 경과 시 구획 경계 선량률은 약 0.13 uSv/hr로 "
        "이 기준을 크게 만족하므로, 원자로 정지 후 1시간 이내에 "
        "정비 접근이 가능하다."
    )

    pdf.add_note(
        "실제 정비 시에는 차폐 내부(원자로 구획 내부)로의 접근이 필요할 수 있으며, "
        "이 경우 차폐가 없는 근거리에서의 선량률이 적용된다. "
        "내부 접근 시에는 추가적인 대기시간 및 개인 방호장비가 요구된다."
    )

    # ===================================================================
    # 7.8 차폐 설계 고찰
    # ===================================================================
    pdf.section_title("7.8 차폐 설계 고찰")

    pdf.subsection_title("7.8.1 중성자 차폐 최적화")

    pdf.body_text(
        "중성자 선량이 지배적인 설계 인자이므로, 중성자 차폐 성능 향상이 "
        "전체 차폐 설계의 핵심이다. 가능한 최적화 방안은 다음과 같다:"
    )

    pdf.add_bullet_list([
        "강재 층 두께 증가: 비탄성산란에 의한 고속 중성자 감속 효과 증대. "
        "그러나 중량 증가가 수반됨",
        "B₄C 농축 ¹⁰B 사용: 자연 붕소(19.9% ¹⁰B) 대신 농축 붕소(>90% ¹⁰B) 사용 시 "
        "열중성자 흡수 효율 약 5배 향상, 두께 저감 가능. 그러나 비용 증가",
        "수소 함유 재료 추가: 폴리에틸렌 또는 수소화 콘크리트 추가 시 "
        "중성자 감속 효율 향상. 내열성 고려 필요",
        "강재/B₄C 복합 배치 최적화: 강재(감속) → B₄C(흡수) 순서 최적화",
    ])

    pdf.subsection_title("7.8.2 차폐 중량 저감 방안")

    pdf.body_text(
        "차폐 중량은 전체 원자로 시스템 중량의 약 65%(~250 톤)를 차지하며, "
        "해양 적용에서 가장 큰 과제 중 하나이다. 중량 저감을 위한 접근 방안은:"
    )

    pdf.add_numbered_list([
        "텅스텐(W) 또는 납(Pb) 기반 고밀도 감마 차폐: 동일 감마 감쇠에 "
        "더 얇은 두께 적용 가능. 특히 텅스텐(밀도 19,300 kg/m³)은 중량 증가에도 "
        "불구하고 체적을 대폭 줄여 전체적으로 유리할 수 있음",
        "물 차폐 활용: 선박의 구조적 이중 저(double bottom)를 수장 탱크로 활용하여 "
        "추가 중성자 감속 제공. 수소의 감속 효과가 매우 우수함",
        "비대칭 차폐: 접근 빈도가 낮은 방향(선저 등)의 차폐를 줄이고, "
        "승무원 거주 방향의 차폐를 강화하는 비대칭 설계",
        "고밀도 콘크리트 골재 개선: BaSO₄보다 밀도가 높은 철 골재(iron shot) 콘크리트 "
        "(밀도 ~4,800 kg/m³) 사용으로 두께 저감",
    ])

    pdf.subsection_title("7.8.3 Monte Carlo 검증 필요성")

    pdf.body_text(
        "본 개념설계에서 사용된 제거단면적법은 보수적 근사이며, 상세설계 단계에서 "
        "반드시 3차원 Monte Carlo 수송 계산으로 검증되어야 한다. "
        "특히 다음 사항은 Monte Carlo 해석 없이는 정확한 평가가 불가능하다:"
    )

    pdf.add_bullet_list([
        "배관 관통부(penetration) 스트리밍: 1차 배관, 계측 배선, 환기 덕트 등이 "
        "차폐체를 관통하는 부위의 방사선 누출(streaming) 평가",
        "차폐 불연속부: 차폐 블록 접합부, 점검 해치 등의 간극에 의한 선량 증가",
        "스카이샤인(skyshine): 상방으로 누출된 방사선의 대기 산란에 의한 간접 피폭",
        "MSR 특유의 노심 외 선원: 순환하는 연료염에 의한 배관/HX 주변 선원항의 "
        "정확한 3차원 분포 평가",
        "에너지 스펙트럼 효과: 다층 차폐를 통과하면서의 스펙트럼 경화(spectral hardening) "
        "및 이에 따른 빌드업 인자 변화",
    ])

    # ===================================================================
    # 7.9 차폐 설계 요약
    # ===================================================================
    pdf.section_title("7.9 차폐 설계 요약")

    pdf.body_text(
        "본 장에서 수행한 40 MWth 해양용 MSR의 차폐 설계 결과를 종합한다."
    )

    pdf.add_table(
        headers=["항목", "값", "비고"],
        rows=[
            ["중성자 선원 강도", "3.034 x 10¹⁸ n/s", "nu = 2.43"],
            ["총 감마선 선원 강도", "1.869 x 10¹⁹ ph/s", "즉발+FP+활성화"],
            ["총 차폐 두께", "162 cm", "4개 층"],
            ["Hastelloy-N (용기벽)", "2 cm", "감마 초기 감쇠"],
            ["강재", "25 cm", "중성자 비탄성산란"],
            ["B₄C", "15 cm", "열중성자 흡수"],
            ["중량 콘크리트", "120 cm", "감마 주력 차폐"],
            ["중성자 총 감쇠비", "5.76 x 10⁻⁷", "지배 인자"],
            ["감마선 총 감쇠비", "4.06 x 10⁻¹³", "-"],
            ["구획경계 최대 선량률", "6.82 uSv/hr", "5 m, 적합"],
            ["거주구역 연간 선량", "0.30 mSv/yr", "< 1 mSv/yr"],
            ["차폐 외경", "~5.0 m", "원통형"],
            ["차폐 추정 중량", "~250 톤", "전체의 65%"],
            ["모든 위치 선량 판정", "적합", "ICRP 103 만족"],
        ],
        col_widths=[45, 50, 70],
        title="표 7.11 차폐 설계 종합 결과"
    )

    pdf.body_text(
        "제거단면적법에 의한 개념설계 차폐 해석 결과, 4층 구조(Hastelloy-N 2 cm + "
        "강재 25 cm + B₄C 15 cm + 중량 콘크리트 120 cm, 총 162 cm)의 차폐 구조가 "
        "선박 내 모든 평가 위치에서 ICRP 103 선량 한계를 만족함을 확인하였다. "
        "중성자 차폐가 설계를 지배하는 인자이며, 상세설계에서 Monte Carlo 코드를 "
        "통한 3차원 검증과 스트리밍 해석이 필수적이다. 차폐 중량(~250 톤)은 "
        "전체 시스템 중량의 65%를 차지하여, 해양 적용 시 중량 최적화가 주요 "
        "설계 과제로 남는다."
    )
